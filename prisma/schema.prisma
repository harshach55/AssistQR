// Prisma schema for Vehicle Safety QR System
// Using Prisma ORM for PostgreSQL database management
// Prisma provides type-safe database access and migrations

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int       @id @default(autoincrement())
  name         String
  email        String    @unique
  passwordHash String    @map("password_hash")
  createdAt    DateTime  @default(now()) @map("created_at")
  
  vehicles     Vehicle[]
  
  @@map("users")
}

model Vehicle {
  id               Int                @id @default(autoincrement())
  userId           Int                @map("user_id")
  licensePlate     String             @map("license_plate")
  model            String?
  color            String?
  qrToken          String             @unique @map("qr_token")
  createdAt        DateTime           @default(now()) @map("created_at")
  
  user             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  emergencyContacts EmergencyContact[]
  accidentReports  AccidentReport[]
  
  @@map("vehicles")
}

model EmergencyContact {
  id          Int      @id @default(autoincrement())
  vehicleId   Int      @map("vehicle_id")
  name        String
  phoneNumber String   @map("phone_number")
  email       String
  createdAt   DateTime @default(now()) @map("created_at")
  
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@map("emergency_contacts")
}

model AccidentReport {
  id             Int             @id @default(autoincrement())
  vehicleId      Int             @map("vehicle_id")
  lat            Float?
  lng            Float?
  manualLocation String?         @map("manual_location")
  helperNote     String?         @map("helper_note")
  createdAt      DateTime        @default(now()) @map("created_at")
  
  vehicle        Vehicle         @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  images         AccidentImage[]
  
  @@map("accident_reports")
}

model AccidentImage {
  id              Int            @id @default(autoincrement())
  accidentReportId Int           @map("accident_report_id")
  imageUrl        String         @map("image_url")
  createdAt       DateTime       @default(now()) @map("created_at")
  
  accidentReport  AccidentReport @relation(fields: [accidentReportId], references: [id], onDelete: Cascade)
  
  @@map("accident_images")
}

